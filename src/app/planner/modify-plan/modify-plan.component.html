<app-loader *ngIf="isLoading"></app-loader>
<div class="container-fluid">
  <h4 class="manulal-plan-header ">
    Dispatch Plan > Modify Plan
    <span class="pull-right refresh-span">
      <button class="theme-small-button" (click)="export()" matTooltip="Export to excel">
        <i class="fa fa-file-excel-o" aria-hidden="true"></i>
      </button>
      <button class="theme-small-button" (click)="refreshData()" matTooltip="Refresh">
        <i class="fa fa-repeat fa-2x" aria-hidden="true"></i>
      </button>
      <button class="theme-small-button" (click)="showFilter()" matTooltip="filter">
        <i class="fa fa-filter fa-2x" aria-hidden="true"></i>
      </button>
    </span>
  </h4>
  <div class="manualplan-fields">
    <div class="col-md-12 row" *ngIf="isShow">
      <div class="col-md-12 padding-right-40">
        <div class="row">
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <input matInput disabled [matDatepicker]="formPicker" placeholder="From Date" [(ngModel)]="fromDate"
                  name="fromDate" (dateChange)="addEvent('fromDate', $event)">
                <mat-datepicker-toggle matSuffix [for]="formPicker"></mat-datepicker-toggle>
                <mat-datepicker #formPicker disabled="false"></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <input matInput disabled [matDatepicker]="toPicker" [min]="fromDate" placeholder="To Date"
                  [(ngModel)]="toDate" name="toDate">
                <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
                <mat-datepicker #toPicker [disabled]="!fromDate"></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <!-- check_Role_DP_REP == roles.planner3  -->
          <!-- <div class="col-md-1 pl-0" *ngIf="service.isDPREPRole()">
            <mat-form-field>
              <input matInput placeholder="Source" (keyup)="getfilterSource($event)" autocomplete="off"
                [matAutocomplete]="sourceAutocomplete" [(ngModel)]="sourceCode" name="source" oninput="this.value = this.value.toUpperCase()">
              <mat-autocomplete #sourceAutocomplete="matAutocomplete">
                <mat-option *ngFor="let list of sourceList" [value]="list.value">
                  <span matTooltip={{list.value}}>{{list.value}} - ({{list.description}})</span>
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div> -->
          <div class="col-md-1 pl-0" *ngIf = "isSoureDisable()">
            <mat-form-field class="example-full-width">
              <input matInput placeholder="Source" (keyup)="getfilterSource($event)" [disabled]="(isSoureDisable()) "
                autocomplete="off" [matAutocomplete]="sourceAutocomplete" [(ngModel)]="sourceCode" name="source" oninput="this.value = this.value.toUpperCase()">
              <mat-autocomplete #sourceAutocomplete="matAutocomplete" >
                <mat-option *ngFor="let list of sourceList" [value]="list.value">
                  <span matTooltip={{list.value}}>{{list.value}} - ({{list.description}})</span>
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>
          <div class="col-md-1 pr-0" *ngIf = "!isSoureDisable()">
              <div class="form-group cust-form-group">
                <mat-form-field class="example-full-width">
                  <mat-select placeholder="Source" [(ngModel)]="sourceCodeList" name="sourceCodeList"
                    multiple [disabled]="(isSoureDisable()) ">
                    <mat-option *ngFor="let source of openPlanSourceList" [value]="source">{{source}}</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <input matInput placeholder="Destination" aria-label="State" [matAutocomplete]="statesAutocomplete"
                  [(ngModel)]="destination" name="destination" (keyup)="getUserSearchData($event)" oninput="this.value = this.value.toUpperCase()">
                <mat-autocomplete #statesAutocomplete="matAutocomplete">
                  <mat-option *ngFor="let list of destinationList" [value]="list.value"
                    (click)="setDestDescription(list.description)"
                    (onSelectionChange)="setDestDescription(list.description)">
                    <span>{{list.value}}</span>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-2 pl-0">
            <div class="form-group">
              <mat-form-field>
                <input matInput placeholder="Destination Description" aria-label="State"
                  [matAutocomplete]="destDisAutocomplete" [(ngModel)]="destinationDesc" name="destination"
                  (keyup)="getUserDestinationList($event)" oninput="this.value = this.value.toUpperCase()">
                <mat-autocomplete #destDisAutocomplete="matAutocomplete">
                  <mat-option *ngFor="let list of descriptionList" [value]="list.description"
                    (click)="setDestination(list.value)" (onSelectionChange)="setDestination(list.value)">
                    <span>({{list.description}})</span>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <input matInput placeholder="Material Code" aria-label="Material Code"
                  [matAutocomplete]="materialCodeAutocomplete" [(ngModel)]="materialCode" name="materialCode"
                  (keyup)="filterMaterialCode($event)" oninput="this.value = this.value.toUpperCase()">
                <mat-autocomplete #materialCodeAutocomplete="matAutocomplete">
                  <mat-option *ngFor="let list of materilcodelist" [value]="list.value"
                    (click)="setMaterialDescription(list.description)"
                    (onSelectionChange)="setMaterialDescription(list.description)">
                    <span>{{list.value}}</span>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <input matInput placeholder="Material Description" aria-label="Material Description"
                  [matAutocomplete]="materialDescriptionAutocomplete" [(ngModel)]="materialDescription"
                  name="materialDescription" (keyup)="filterMaterialDescription($event)" oninput="this.value = this.value.toUpperCase()">
                <mat-autocomplete #materialDescriptionAutocomplete="matAutocomplete">
                  <mat-option *ngFor="let list of materialDescriptionList" [value]="list.description"
                    (click)="setMaterialCode(list.value)" (onSelectionChange)="setMaterialCode(list.value)">
                    <span>{{list.description}}</span>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <mat-select placeholder="Category" [(ngModel)]="materialGroup" name="materialGroup" multiple>
                  <mat-option *ngFor="let category of categoryList" [value]="category">{{category}}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <mat-select placeholder="MKT Segment" [(ngModel)]="mktsegment" name="mktsegment" multiple>
                  <!-- <mat-option [value]="">None</mat-option> -->
                  <mat-option *ngFor="let mktsegment of mktsegmentList" [value]="mktsegment">
                    {{mktsegment}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <input matInput placeholder="Plan Id" [(ngModel)]="planId" name="planId" oninput="this.value = this.value.toUpperCase()">
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <mat-select placeholder="Plan Status" [(ngModel)]="planStatus" name="planStatus" multiple>
                  <!-- <mat-option [value]="">None</mat-option> -->
                  <mat-option *ngFor="let item of planStatusList" [value]="item.value">
                    {{item.key}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <mat-select placeholder="Status" [(ngModel)]="status" name="status" multiple>
                  <!-- <mat-option [value]="">None</mat-option> -->
                  <mat-option *ngFor="let data of statuses" [value]="data.value">{{data.key}}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field>
                <input matInput placeholder="Insert User" [(ngModel)]="insertUser" name="insertUser" oninput="this.value = this.value.toUpperCase()">
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-1 pl-0">
            <div class="form-group">
              <mat-form-field class="example-full-width">
                <mat-select placeholder="Priority" [(ngModel)]="priority" name="priority" multiple>
                  <mat-option value="ISNULL">ISNULL</mat-option>
                  <mat-option *ngFor="let priority of priorityList" [value]="priority">{{priority}}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>
      <div class="pull-right">
        <div class="search-fileds">
          <button class="theme-small-button" (click)="plannerSearch()" matTooltip="Search">
            <i class="fa fa-search fa-2x" aria-hidden="true"></i>
          </button>
          <button class="theme-delete-button" (click)="clearAll()" matTooltip="Clear">
            <i class="fa fa-times" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="clearfix"></div>
  <div class="datatable ngx-table-custom-scroll ngx-table-tr-custom-scroll">
    <!-- Data table starts -->
    <ngx-datatable #table class="material" [columnMode]="'force'" [scrollbarH]="true" [headerHeight]="50"
      [footerHeight]="30" [rowHeight]="'auto'" [rows]="modifyPlanData" [externalPaging]="true" [limit]="page.limit"
      [count]="page.count" [offset]="page.offset" (page)="datatablePageData($event)" [selected]="selected"
      [selectionType]="'checkbox'" [selectAllRowsOnPage]="false" [summaryRow]="true" [summaryHeight]="'auto'"
      [summaryPosition]="'bottom'">
      <ngx-datatable-column [width]="50" [frozenLeft]="true" *ngIf="!responsiveHideShow" [sortable]="false" [canAutoResize]="false" [draggable]="false"
      [resizeable]="false" [sortable]="false">
      <ng-template ngx-datatable-header-template let-value="value" let-allRowsSelected="allRowsSelected"
        let-selectFn="selectFn" let-row="row" let-rowIndex="rowIndex">
        <input type="checkbox" [checked]="allRowsSelected"
          (change)="selectFn(!allRowsSelected);onSelectAll($event)" />
      </ng-template>
      <ng-template ngx-datatable-cell-template let-value="value" let-isSelected="isSelected" let-row="row"
        let-rowIndex="rowIndex" let-onCheckboxChangeFn="onCheckboxChangeFn">
        <input type="checkbox" [checked]="isSelected" (change)="onCheckboxChangeFn($event);onSelect($event,row)" />
      </ng-template>
    </ngx-datatable-column>
      <ngx-datatable-column name="Action" [frozenLeft]="true" *ngIf="!responsiveHideShow" [width]="60" [resizeable]="false" [sortable]="false">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <!-- (row.dispatchedQuantity == 0) && (row.reservedQuantity == 0) -->
          <button class="theme-small-button btn" matTooltip="Modify plan" (click)="rowLevelModifyPlan(row)"
            [disabled]="(row.isError)">
            <i class="fa fa-floppy-o" aria-hidden="true"></i>
          </button>
          <!-- Commented as per new requiremet on 11/07/2019 -->
          <!-- If the Dispatch Qty & Reserved Qty & Loaded Qty is there He cant do any delet action -->
          <!-- <span *ngIf="(row.dispatchedQuantity == 0) && (row.reservedQuantity == 0) && (row.loaded == 0)">
            <button class="theme-delete-button btn" matTooltip="Delete plan" (click)="rowlevelDeletePlan(row)">
              <i class="fa fa-trash-o fa-2x" aria-hidden="true"></i>
            </button>
          </span> -->
        </ng-template>
      </ngx-datatable-column>
      <!-- Plan Id column -->
      <ngx-datatable-column [frozenLeft]="true" name="Plan Id" [width]="60" [resizeable]="false" [sortable]="false"
        prop="planId" [summaryFunc]="emptySumm">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.planId}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <!-- Dispatch plan column -->
      <ngx-datatable-column [frozenLeft]="true" name="Disp Date" [width]="110" [resizeable]="false" [sortable]="false"
        prop="dispatchDate">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <ng-container *ngIf="row.status !== 'COMPLETED'">
            <div *ngIf="isView(row)">
              {{row.dispatchDate | customDateFormat | date:'dd-MMM-yyyy'}}
            </div>
            <div *ngIf="isEdit(row)">
              <div class="edit-field" title="Double click to edit"
                (click)="editing[rowIndex + '-dispatchDate'] = true" *ngIf="!editing[rowIndex + '-dispatchDate']">
                <span class="edit-label">{{row.dispatchDate | customDateFormat | date:'dd-MMM-yyyy'}}
                </span>
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </div>
              <mat-form-field *ngIf="editing[rowIndex+ '-dispatchDate']">
                <input matInput [matDatepicker]="rowIndexPicker" [value]="row.formattedDate" autofocus
                  (dateChange)="updateValue(row,$event,'dispatchDate',rowIndex)">
                <mat-datepicker-toggle matSuffix [for]="rowIndexPicker"></mat-datepicker-toggle>
                <mat-datepicker #rowIndexPicker></mat-datepicker>
              </mat-form-field>
            </div>
          </ng-container>
          <ng-container *ngIf="row.status === 'COMPLETED'">
            {{row.dispatchDate | customDateFormat | date:'dd-MMM-yyyy'}}
          </ng-container>
        </ng-template>
      </ngx-datatable-column>

      <!-- Source column -->
      <ngx-datatable-column [frozenLeft]="true" name="Source" [width]="60" [resizeable]="false" [sortable]="false"
        prop="sourceLocation">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.sourceLocation}}
          </div>
        </ng-template>
      </ngx-datatable-column>

      <!-- Destination Column -->
      <ngx-datatable-column [frozenLeft]="true" name="Dest" [width]="70" [resizeable]="false" [sortable]="false"
        prop="destinationLocation">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <ng-container *ngIf="row.status !== 'COMPLETED'">
            <div *ngIf="isEdit(row)">
              <div class="edit-field" title="Double click to edit"
                (click)="editing[rowIndex + '-destinationLocation'] = true"
                *ngIf="!editing[rowIndex + '-destinationLocation']">
                <span class="edit-label">{{row.destinationLocation}}
                </span>
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </div>
              <mat-form-field *ngIf="editing[rowIndex+ '-destinationLocation']">
                <input matInput [matAutocomplete]="datatableDestAutocomplete"
                  (blur)="updateValue(row,$event, 'destinationLocation', rowIndex)" [value]="row.destinationLocation"
                  autofocus (keyup)="getdatatableDestinatinList($event)" oninput="this.value = this.value.toUpperCase()">
                <mat-autocomplete #datatableDestAutocomplete="matAutocomplete">
                  <mat-option *ngFor="let list of datatableDestinationList" [value]="list.value">
                    <span>{{list.value}}</span>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div *ngIf="isView(row)">
              {{row.destinationLocation}}</div>
          </ng-container>
          <ng-container *ngIf="row.status === 'COMPLETED'">
            {{row.destinationLocation}}
          </ng-container>
        </ng-template>
      </ngx-datatable-column>

      <!-- Material Code -->
      <ngx-datatable-column [frozenLeft]="freezeLeftValue" name="Material Code" [width]="130" [resizeable]="false"
        [sortable]="false" prop="itemId">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <ng-container *ngIf="row.status !== 'COMPLETED'">
            <div *ngIf="isEdit(row)">
              <div class="edit-field" title="Double click to edit" (click)="editing[rowIndex + '-itemId'] = true"
                *ngIf="!editing[rowIndex + '-itemId']">
                <span class="edit-label">{{row.itemId}}
                </span>
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </div>
              <mat-form-field *ngIf="editing[rowIndex+ '-itemId']">
                <input autofocus matInput [matAutocomplete]="datatableMaterialCodeAutocomplete"
                  (blur)="updateValue(row,$event, 'itemId', rowIndex)" [value]="row.itemId"
                  (keyup)="filterMaterialCodeDatatables($event,rowIndex)" oninput="this.value = this.value.toUpperCase()">
                <mat-autocomplete #datatableMaterialCodeAutocomplete="matAutocomplete">
                  <mat-option *ngFor="let list of datamaterilcodelist;let i=index" [value]="list.value"
                    (click)="setMaterialDesDatatable(list.description,rowIndex)"
                    (onSelectionChange)="setMaterialDesDatatable(list.description,rowIndex)">
                    <span>{{list.value}}</span>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div *ngIf="isView(row)">{{row.itemId}}
            </div>
          </ng-container>
          <ng-container *ngIf="row.status === 'COMPLETED'">
            {{row.itemId}}
          </ng-container>
        </ng-template>
      </ngx-datatable-column>
      <!-- Material Description -->
      <ngx-datatable-column [frozenLeft]="freezeLeftValue" name="Material Description" [width]="220" [resizeable]="false"
        [sortable]="false" prop="itemDescription">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.itemDescription}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <!-- Destination Description -->
      <ngx-datatable-column name="Dest Description" [width]="150" [resizeable]="false" [sortable]="false"
        prop="destinationDescription">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          {{row.destinationDescription}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Cat" [width]="50" [resizeable]="false" [sortable]="false" prop="category">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.category}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="TTE" [width]="60" [resizeable]="false" [sortable]="true" prop="tte"
        [summaryTemplate]="tteCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.tte}}
        </ng-template>
      </ngx-datatable-column>

      <!-- Batch Code -->
      <ngx-datatable-column name="Batch" [width]="70" [resizeable]="false" [sortable]="false" prop="batchCode">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <ng-container *ngIf="row.status !== 'COMPLETED'">
            <div *ngIf="isEdit(row)">
              <div class="edit-field" title="Double click to edit" (click)="editing[rowIndex + '-batchCode'] = true"
                *ngIf="!editing[rowIndex + '-batchCode']">
                <span class="edit-label">{{row.batchCode}}
                </span>
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </div>
              <mat-form-field *ngIf="editing[rowIndex+ '-batchCode']">
                <input matInput [matAutocomplete]="datatableBatchcodeAutocomplete"
                  (blur)="updateValue(row,$event, 'batchCode', rowIndex)" [value]="row.batchCode" autofocus
                  (keyup)="datatablesBatchcode($event)" oninput="this.value = this.value.toUpperCase()">
                <mat-autocomplete #datatableBatchcodeAutocomplete="matAutocomplete">
                  <mat-option *ngFor="let list of datatablesBatchcodeList" [value]="list.value">
                    <span>{{list.value}}</span>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div *ngIf="isView(row)">
              {{row.batchCode}}
            </div>
          </ng-container>
          <ng-container *ngIf="row.status === 'COMPLETED'">
            {{row.batchCode}}
          </ng-container>
        </ng-template>
      </ngx-datatable-column>


      <!-- Priority -->
      <ngx-datatable-column name="Pr" [width]="60" [resizeable]="false" [sortable]="false" prop="priority"
        [summaryFunc]="emptySumm">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <!-- plan status is completed then can't edit the field -->
          <ng-container *ngIf="row.status !== 'COMPLETED'">
            <div *ngIf="isEdit(row)">
              <div class="edit-field" title="Double click to edit" (click)="editing[rowIndex + '-priority'] = true"
                *ngIf="!editing[rowIndex + '-priority']">
                <span class="edit-label">{{row.priority}}
                </span>
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </div>
              <ng-container *ngIf="editing[rowIndex+ '-priority']">
                <input class="table-input" autofocus (blur)="updateValue(row,$event, 'priority', rowIndex)"
                  [value]="row.priority" (keypress)="service.numberOnly($event)">
              </ng-container>
            </div>
            <div *ngIf="isView(row)">
              {{row.priority}}
            </div>
          </ng-container>
          <ng-container *ngIf="row.status === 'COMPLETED'">
            {{row.priority}}
          </ng-container>
        </ng-template>
      </ngx-datatable-column>

      <!--MKT segment  -->
      <ngx-datatable-column name="MKT Seg" [width]="70" [resizeable]="false" [sortable]="false" prop="marketSegment">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <ng-container *ngIf="row.status !== 'COMPLETED'">
            <div *ngIf="isEdit(row)">
              <div class="edit-field" title="Double click to edit"
                (click)="editing[rowIndex + '-marketSegment'] = true" *ngIf="!editing[rowIndex + '-marketSegment']">
                <span class="edit-label">{{row.marketSegment}}
                </span>
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </div>
              <ng-container *ngIf="editing[rowIndex + '-marketSegment']">
                <mat-select autofocus placeholder="MKT Segment" [ngModel]="row.marketSegment"
                  name="mktsegment{{rowIndex}}" (ngModelChange)="updateValue(row,$event, 'marketSegment', rowIndex)">
                  <mat-option *ngFor="let mktsegment of mktsegmentList" [value]="mktsegment">
                    {{mktsegment}}
                  </mat-option>
                </mat-select>
              </ng-container>
            </div>
            <div *ngIf="isView(row)">
              {{row.marketSegment}}
            </div>
          </ng-container>
          <ng-container *ngIf="row.status === 'COMPLETED'">
            {{row.marketSegment}}
          </ng-container>
        </ng-template>
      </ngx-datatable-column>

      <!-- Quantity-->
      <ngx-datatable-column name="Plan Qty" [width]="60" [resizeable]="false" [sortable]="false" prop="quantity"
        [summaryTemplate]="planQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <ng-container *ngIf="row.status !== 'COMPLETED'">
            <div *ngIf="isEdit(row)">
              <div class="edit-field" title="Double click to edit" (click)="editing[rowIndex + '-quantity'] = true"
                *ngIf="!editing[rowIndex + '-quantity']">
                <span class="edit-label">{{row.quantity}}
                </span>
                <i class="fa fa-pencil" aria-hidden="true"></i>
              </div>
              <ng-container *ngIf="editing[rowIndex+ '-quantity']">
                <input class="table-input" autofocus (blur)="updateValue(row,$event, 'quantity', rowIndex)"
                  [value]="row.quantity" (input)="editPlanQty($event,row,rowIndex)"
                  (keypress)="service.numberOnly($event)">
              </ng-container>
            </div>
            <div *ngIf="isView(row)">
              {{row.quantity}}
            </div>
          </ng-container>
          <ng-container *ngIf="(row.status === 'COMPLETED')">
            {{row.quantity}}
          </ng-container>
        </ng-template>
      </ngx-datatable-column>

      <!-- Approve Quantity -->
      <ngx-datatable-column name="App Qty" [width]="60" [resizeable]="false" [sortable]="false" prop="approvedQuantity"
        [summaryTemplate]="apprQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.approvedQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Un Appr Qty" [width]="70" [resizeable]="false" [sortable]="false"
        prop="unapprovedQuantity" [summaryTemplate]="unapprQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.unapprovedQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Appr Del" [width]="70" [resizeable]="false" [sortable]="false"
        prop="deletedApprQuantity" [summaryTemplate]="apprDeleteQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.deletedApprQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Un Appr Del" [width]="70" [resizeable]="false" [sortable]="false"
        prop="deletedUnApprQuantity" [summaryTemplate]="unapprDeleteQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.deletedUnApprQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Reserved" [width]="70" [resizeable]="false" [sortable]="false" prop="reservedQuantity"
        [summaryTemplate]="reservedQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.reservedQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Loaded" [width]="70" [resizeable]="false" [sortable]="false" prop="loaded"
        [summaryTemplate]="loadedQtyCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{(row.loaded)?(row.loaded):0}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Disp" [width]="70" [resizeable]="false" [sortable]="false" prop="dispatchedQuantity"
        [summaryTemplate]="dispatchedQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.dispatchedQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Avail Qty" [width]="70" [resizeable]="false" [sortable]="false"
        prop="availableQuantity" [summaryTemplate]="availableQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.availableQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Tot Avail Qty" [width]="70" [resizeable]="false" [sortable]="false"
        prop="totalAvailableQuantity" [summaryTemplate]="totalAvailableQtyCell">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div>
            {{row.totalAvailableQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Qty to be Del Appr" [width]="70" [resizeable]="false" [sortable]="false"
        prop="deleteApprQuantity" [summaryFunc]="emptySumm">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div *ngIf="(((row.totalAvailableQuantity)?(row.totalAvailableQuantity):0) > 0)">
            <div class="edit-field" title="Double click to edit"
              (click)="editing[rowIndex + '-deleteApprQuantity'] = true"
              *ngIf="!editing[rowIndex + '-deleteApprQuantity']">
              <span class="edit-label">{{row.deleteApprQuantity}}
              </span>
              <i class="fa fa-pencil" aria-hidden="true"></i>
            </div>
            <ng-container *ngIf="editing[rowIndex + '-deleteApprQuantity']">
              <input class="table-input" autofocus type="number" min="0"
                (blur)="updateValue(row,$event, 'deleteApprQuantity', rowIndex)" [value]="row.deleteApprQuantity"
                (input)="deleteApprQty($event,row,rowIndex)" (keypress)="service.numberOnly($event)">
            </ng-container>
          </div>
          <div *ngIf="(((row.totalAvailableQuantity)?(row.totalAvailableQuantity):0) == 0)">
            {{row.deleteApprQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Qty to be Del Un Appr" [width]="90" [resizeable]="false" [sortable]="false"
        prop="deleteUnApprQuantity" [summaryFunc]="emptySumm">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <div *ngIf="(((row.totalAvailableQuantity)?(row.totalAvailableQuantity):0) > 0)">
            <div class="edit-field" title="Double click to edit"
              (click)="editing[rowIndex + '-deleteUnApprQuantity'] = true"
              *ngIf="!editing[rowIndex + '-deleteUnApprQuantity']">
              <span class="edit-label">{{row.deleteUnApprQuantity}}
              </span>
              <i class="fa fa-pencil" aria-hidden="true"></i>
            </div>
            <ng-container *ngIf="editing[rowIndex + '-deleteUnApprQuantity']">
              <input class="table-input" autofocus oncopy="return false" oncut="return false" onpaste="return false"
                (blur)="updateValue(row,$event, 'deleteUnApprQuantity', rowIndex)" [value]="row.deleteUnApprQuantity"
                (input)="deleteUnApprQty($event,row,rowIndex)" (keypress)="service.numberOnly($event)">
            </ng-container>
          </div>
          <div *ngIf="(((row.totalAvailableQuantity)?(row.totalAvailableQuantity):0) == 0)">
            {{row.deleteUnApprQuantity}}
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Avail TTE" [width]="80" [resizeable]="false" [sortable]="true" prop="availbleTTE"
        [summaryTemplate]="totalAvailableTTEPercentageCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.availbleTTE | number : '1.2-2' }}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Truck Count" [width]="80" [resizeable]="false" [sortable]="true" prop="truckCount"
        [summaryTemplate]="truckPercentageCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.truckCount | number : '1.2-2'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Weight (Kg)" [width]='60' [resizeable]="false" [sortable]="false" prop="Weight"
      [summaryTemplate]="weightCell">
      <ng-template let-row="row" ngx-datatable-cell-template>
        {{row.weight | number : '1.2-2'}}
      </ng-template>
    </ngx-datatable-column>
      <ngx-datatable-column name="Available Weight (Kg)" [width]='80' [resizeable]="false" [sortable]="false" prop="totalWeight"
        [summaryTemplate]="totalWeightCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.totalWeight | number : '1.2-2'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Weight Util (%)" [width]='60' [resizeable]="false" [sortable]="false" prop="weightUtil"
        [summaryTemplate]="totalWeightUtilCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.weightUtil | number : '1.2-2'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Volume (CUMTR)" [width]='70' [resizeable]="false" [sortable]="false" prop="Volume"
        [summaryTemplate]="volumeCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.volume | number : '1.2-2'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Available Volume (CUMTR)" [width]='110' [resizeable]="false" [sortable]="false" prop="totalVolume"
        [summaryTemplate]="totalVolumeCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.totalVolume | number : '1.2-2'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Volume Util (%)" [width]='80' [resizeable]="false" [sortable]="false" prop="volume"
        [summaryTemplate]="totalVolumeUtilCell">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.volumeUtil | number : '1.2-2'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Plan Status" [width]='100' [resizeable]="false" [sortable]="false" prop="appStatus">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.status}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Insert User" [width]="145" [resizeable]="false" [sortable]="false" prop="insertUser">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          {{row.insertUser}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Update User" [width]='145' [resizeable]="false" [sortable]="false" prop="updateUser">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.updateUser}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Insert Date" [width]='130' [resizeable]="false" [sortable]="false" prop="insertDate">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.insertDate | customDateFormat | date:'dd-MMM-yyyy,HH:mm'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Update Date" [width]='130' [resizeable]="false" [sortable]="false" prop="updateDate">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.updateDate | customDateFormat | date:'dd-MMM-yyyy,HH:mm'}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Plan Age (Days)" [width]='70' [resizeable]="false" [sortable]="false" prop="planAge">
        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row.planAge}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Comments" [width]='100' [resizeable]="false" [sortable]="false" prop="comments">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <span [attr.title]="row.comments" (click)="showIntegrationMessage(row)">{{
            (row.comments?.length>9)? (row.comments | slice:0:9)+'..':(row.comments)}}</span>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Status" [width]='140' [resizeable]="false" [sortable]="false" prop="appStatus">
        <ng-template let-row="row" ngx-datatable-cell-template>
          <button class="btn btn-sm lightgreen-button"
            [ngClass]="(row.appStatus=='APPROVED')?'lightgreen-button':'light-red-color'">
            {{row.appStatus}}
          </button>
        </ng-template>
      </ngx-datatable-column>
      <!-- Actions -->
      <ngx-datatable-column name="Action"  *ngIf="responsiveHideShow" [width]="100" [resizeable]="false" [sortable]="false">
        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row">
          <!-- (row.dispatchedQuantity == 0) && (row.reservedQuantity == 0) -->
          <button class="theme-small-button btn" matTooltip="Modify plan" (click)="rowLevelModifyPlan(row)"
            [disabled]="(row.isError)">
            <i class="fa fa-floppy-o" aria-hidden="true"></i>
          </button>
          <!-- Commented as per new requiremet on 11/07/2019 -->
          <!-- If the Dispatch Qty & Reserved Qty & Loaded Qty is there He cant do any delet action -->
          <!-- <span *ngIf="(row.dispatchedQuantity == 0) && (row.reservedQuantity == 0) && (row.loaded == 0)">
            <button class="theme-delete-button btn" matTooltip="Delete plan" (click)="rowlevelDeletePlan(row)">
              <i class="fa fa-trash-o fa-2x" aria-hidden="true"></i>
            </button>
          </span> -->
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column [width]="50" *ngIf="responsiveHideShow" [sortable]="false" [canAutoResize]="false" [draggable]="false"
        [resizeable]="false" [sortable]="false">
        <ng-template ngx-datatable-header-template let-value="value" let-allRowsSelected="allRowsSelected"
          let-selectFn="selectFn" let-row="row" let-rowIndex="rowIndex">
          <input type="checkbox" [checked]="allRowsSelected"
            (change)="selectFn(!allRowsSelected);onSelectAll($event)" />
        </ng-template>
        <ng-template ngx-datatable-cell-template let-value="value" let-isSelected="isSelected" let-row="row"
          let-rowIndex="rowIndex" let-onCheckboxChangeFn="onCheckboxChangeFn">
          <input type="checkbox" [checked]="isSelected" (change)="onCheckboxChangeFn($event);onSelect($event,row)" />
        </ng-template>
      </ngx-datatable-column>
       <!-- Footer Template starts -->
       <ngx-datatable-footer>
        <ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="pageSize" let-selectedCount="selectedCount"
          let-curPage="curPage" let-offset="offset" let-isVisible="isVisible">
          <div class="page-count">
            <span *ngIf="selectedCount">
              {{selectedCount.toLocaleString()}} Selected | 
            </span>
            Showing {{(offset * pageSize)+1}} to {{(rowCount>
            (curPage*pageSize))?(curPage*pageSize):(rowCount)}} of
            {{(rowCount)}} records.
          </div>
          <datatable-pager [pagerLeftArrowIcon]="'datatable-icon-left'" [pagerRightArrowIcon]="'datatable-icon-right'"
            [pagerPreviousIcon]="'datatable-icon-prev'" [pagerNextIcon]="'datatable-icon-skip'" [page]="curPage" [size]="pageSize"
            [count]="rowCount" [hidden]="!((rowCount / pageSize) > 1)" (change)="table.onFooterPage($event)">
          </datatable-pager>
        </ng-template>
      </ngx-datatable-footer>
      <!-- Footer Template Ends -->
    </ngx-datatable>
    <!-- Table bottom grid columns -->
    <ng-template #tteCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{(tteSum)?(tteSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #planQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{planQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #apprQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{apprQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #unapprQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{unapprQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #apprDeleteQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{apprDeleteQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #unapprDeleteQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{unapprDeleteQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #reservedQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{reservedQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #loadedQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{loadedQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #dispatchedQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{dispatchedQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #availableQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{availableQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #totalAvailableQtyCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{totalAvailableQtySum}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #truckPercentageCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">
            {{(TruckPercentageSum)?(TruckPercentageSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #totalAvailableTTEPercentageCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">{{(totalTTEPercentageSum)?(totalTTEPercentageSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #weightCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">{{(weightSum)?(weightSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #totalWeightCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">{{(totalWeightSum)?(totalWeightSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #totalWeightUtilCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">{{(totalWeightUtilSum)?(totalWeightUtilSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #volumeCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">{{(volumeSum)?(volumeSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #totalVolumeCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">{{(totalVolumeSum)?(totalVolumeSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <ng-template #totalVolumeUtilCell>
      <div class="name-container">
        <div class="chip">
          <span class="chip-content">{{(totalVolumeUtilSum)?(totalVolumeUtilSum | number :'1.2-2'):0}}
          </span>
        </div>
      </div>
    </ng-template>
    <!-- Data table ends -->

    <div class="text-center margin-TB-20">
      <button mat-raised-button color="primary" class="btm-action-btn mb-3" (click)="multilevelModifyPlan()"
        *ngIf="(markasDeletePlans.length > 0)">Save</button>
        <!-- Commented as per requiremented on 12/07/2019 -->
      <!-- <button mat-raised-button color="primary" class="mb-3" (click)="multilevelDeletePlan()"
        *ngIf="(markasDeletePlans.length > 0)">Delete</button> -->
    </div>
  </div>
</div>


<div id="commnetsModal" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Comments</h4>
      </div>
      <div class="modal-body">
        {{modalComment}}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>